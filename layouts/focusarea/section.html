{{ partial "header.html" . }}

<div class="container">
    <div style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
        <h4 style="margin: 0; color: #856404;">
            <strong>ðŸ§ª Experimental Feature</strong>
        </h4>
        <p style="margin: 10px 0 0 0; color: #856404;">
            Focus Areas are an experimental feature that groups related content by tags. This page and its functionality may change as we refine the categorization system.
        </p>
    </div>

<h1>{{ .Title | markdownify | humanize | title }}</h1>

{{ .Content }}

    {{ if gt (len .Pages) 0 }}
    <div style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #007bff;">
        <h3>Focus Areas Overview</h3>
        <ul>
            <li><strong>Total Focus Areas:</strong> {{ len .Pages }}</li>
            {{ $totalEntries := 0 }}
            {{ $totalTags := slice }}
            {{ range .Pages }}
                {{ if .Params.related_tags }}
                    {{ $totalTags = $totalTags | append .Params.related_tags }}
                    {{ $related_tags := .Params.related_tags }}
                    {{ $matching_pages := slice }}
                    {{ range $tag := $related_tags }}
                        {{ if isset $.Site.Taxonomies.tag $tag }}
                            {{ $matching_pages = $matching_pages | append ($.Site.Taxonomies.tag.Get $tag).Pages }}
                        {{ end }}
                    {{ end }}
                    {{ $totalEntries = add $totalEntries (len (uniq $matching_pages)) }}
                {{ end }}
            {{ end }}
            <li><strong>Total Content Entries:</strong> {{ $totalEntries }}</li>
            <li><strong>Unique Tags Covered:</strong> {{ len (uniq $totalTags) }}</li>
        </ul>
    </div>
    {{ end }}
</div>

{{ if gt (len .Pages) 0 }}
<div class="container">
    <h2>Focus Areas Cloud (Listed by content count)</h2>
    <hr />
    
    {{ $fontUnit := "rem" }}
    {{ $largestFontSize := 2.7 }}
    {{ $smallestFontSize := 1.5 }}
    {{ $fontSpread := sub $largestFontSize $smallestFontSize }}
    
    {{/* Calculate max and min entry counts */}}
    {{ $max := 1 }}
    {{ $min := 999999 }}
    {{ range .Pages }}
        {{ if .Params.related_tags }}
        {{ $related_tags := .Params.related_tags }}
        {{ $matching_pages := slice }}
            {{ range $tag := $related_tags }}
                {{ if isset $.Site.Taxonomies.tag $tag }}
                    {{ $matching_pages = $matching_pages | append ($.Site.Taxonomies.tag.Get $tag).Pages }}
                {{ end }}
            {{ end }}
            {{ $count := len (uniq $matching_pages) }}
            {{ if gt $count $max }}{{ $max = $count }}{{ end }}
            {{ if lt $count $min }}{{ $min = $count }}{{ end }}
        {{ end }}
    {{ end }}
    
    {{ $spread := sub $max $min }}
    {{ $fontStep := div $fontSpread $spread }}

    <div id="focusarea-cloud" style="padding: 5px 15px; line-height: 1.5; word-spacing: 10px">
        {{ $focusAreasWithCounts := slice }}
        {{ range .Pages }}
            {{ if .Params.related_tags }}
                {{ $related_tags := .Params.related_tags }}
                {{ $matching_pages := slice }}
                {{ range $tag := $related_tags }}
                    {{ if isset $.Site.Taxonomies.tag $tag }}
                        {{ $matching_pages = $matching_pages | append ($.Site.Taxonomies.tag.Get $tag).Pages }}
                    {{ end }}
                {{ end }}
                {{ $count := len (uniq $matching_pages) }}
                {{ $focusAreasWithCounts = $focusAreasWithCounts | append (dict "Page" . "Count" $count) }}
            {{ end }}
        {{ end }}
        {{ $sortedFocusAreas := sort $focusAreasWithCounts "Count" "desc" }}
        {{ range $sortedFocusAreas }}
            {{ $count := .Count }}
            {{ $currentFontSize := add $smallestFontSize (mul (sub $count $min) $fontStep) }}
            {{ if eq $spread 0 }}{{ $currentFontSize = $largestFontSize }}{{ end }}
            
            <a href="{{ .Page.RelPermalink }}" style="font-size:{{ $currentFontSize }}{{ $fontUnit }}">{{ .Page.Title | humanize | title }}{{ if gt $count 0 }}<sub>({{ $count }})</sub>{{ end }}</a>
        {{ end }}
    </div>
    </div>
{{ else }}
<div class="container">
    <div style="margin: 20px 0; padding: 15px; background-color: #f8d7da; border-left: 4px solid #dc3545;">
        <h3>No Focus Areas Found</h3>
        <p>No focus areas have been created yet.</p>
    </div>
</div>
{{ end }}

{{ partial "footer.html" . }} 