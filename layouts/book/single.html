{{ partial "header.html" . }}

{{ $hacker_names := slice }}
{{ $unique_hacker_names := slice }}
{{ range .Pages }}
  {{ $hacker_names = $hacker_names | append .Params.hacker }}
{{ end }}
{{ $unique_hacker_names = uniq (sort $hacker_names) }}
{{ $book_id := urlize .Params.print_isbn13 }}

{{ $img_link := slice }}

{{if not .IsHome }}
<!-- Book Detail Layout -->
<div class="book-detail">
  <div>
    {{ $img_loc := printf "%s.*" $book_id | printf "%s%s" "/book/" }}
    {{ with try ( resources.GetMatch $img_loc ) }}
      {{ with .Err }}
        <div class="book-placeholder">No Cover Available</div>
      {{ else }}
        {{ $img_link = .Value }}
        <img src='{{ ($img_link.Resize "x400 q100").RelPermalink }}' alt="{{ $.Title }}" class="book-cover" />
      {{ end }}
    {{ end }}
  </div>
  
  <div class="book-info">
    <h1>{{ .Title | markdownify }}</h1>
    
    <div class="book-authors">
      {{ $indianHackers := slice }}
      {{ $otherAuthors := slice }}
      
      {{ range .Params.hacker }}
        {{ $indianHackers = $indianHackers | append (dict "name" . "isHacker" true) }}
      {{ end }}
      
      {{ range .Params.morehackers }}
        {{ $otherAuthors = $otherAuthors | append . }}
      {{ end }}
      
      {{ range $index, $author := $indianHackers }}
        {{ if gt $index 0 }}, {{ end }}
        <a href="/hacker/{{ $author.name }}/">{{ replace ($author.name | humanize | title) " 1" " " }}</a>
      {{ end }}
      
      {{ if and (gt (len $indianHackers) 0) (gt (len $otherAuthors) 0) }}, {{ end }}
      
      {{ range $index, $author := $otherAuthors }}
        {{ if gt $index 0 }}, {{ end }}
        <span>{{ $author | humanize | title }}</span>
      {{ end }}
    </div>
    
    {{ partial "book.html" . }}
    
    <div class="book-metadata">
      <div class="metadata-item">
        <div class="metadata-label">ğŸ“… Published</div>
        <div class="metadata-value">{{ .Params.published_on }}</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">ğŸ“˜ ISBN-13</div>
        <div class="metadata-value">{{ .Params.print_isbn13 }}</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">ğŸ¢ Publisher</div>
        <div class="metadata-value">{{ .Params.publisher }}</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">ğŸ“ Length</div>
        <div class="metadata-value">{{ .Params.length }} pages</div>
      </div>
    </div>
  </div>
</div>

<!-- Book Description -->
<section class="book-description">
  {{ if .Content }}
    <h2>About This Book</h2>
    {{ .Content }}
  {{ end }}
  
  <div class="info-box">
    <p><small>* Book purchase links might be affiliate links and could result in some passive earning to the site maintainer</small></p>
  </div>
</section>
{{ end }}

{{ partial "footer.html" . }} 