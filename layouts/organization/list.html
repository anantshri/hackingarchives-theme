{{ if $.Site.Params.experimental_mode }}
  {{ partial "header.html" . }}

  <div class="notice warning">
      <h4 class="notice-title">
          <strong>ðŸ§ª Experimental Feature</strong>
      </h4>
      <p>
          Organization-based content organization is an experimental feature. This page and its functionality may change as we refine the organization taxonomy.
      </p>
  </div>

  {{if not .IsHome }}
  <h1>{{ .Title | markdownify | humanize | title }}</h1>
  {{ end }}

  {{ .Content  }}

  {{/* Get all hackers with this organization */}}
  {{ $hackersWithOrg := .Pages }}

  {{/* Build hacker session count dictionary */}}
  {{ $hackerSessionCount := dict }}
  {{ range $hackersWithOrg }}
    {{ $hackerDir := .File.Dir | replaceRE "^hacker/" "" | replaceRE "/$" "" }}
    {{ $sessionCount := 0 }}
    
    {{/* Count sessions for this hacker across all content */}}
    {{ range $.Site.RegularPages }}
      {{ if .Params.hacker }}
        {{ range .Params.hacker }}
          {{ if eq . $hackerDir }}
            {{ $sessionCount = add $sessionCount 1 }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{ if gt $sessionCount 0 }}
      {{ $hackerSessionCount = merge $hackerSessionCount (dict $hackerDir (dict "Name" .Title "Count" $sessionCount)) }}
    {{ end }}
  {{ end }}

  {{/* Build sorted slice for cloud */}}
  {{ $hackerPairs := slice }}
  {{ range $k, $v := $hackerSessionCount }}
    {{ $hackerPairs = $hackerPairs | append (dict "Key" $k "Name" $v.Name "Value" $v.Count) }}
  {{ end }}
  {{ $hackerCountSorted := sort $hackerPairs "Value" "desc" }}

  {{/* Font size logic */}}
  {{ $fontUnit := "rem" }}
  {{ $largestFontSize := 2.7 }}
  {{ $smallestFontSize := 1.5 }}
  {{ $fontSpread := sub $largestFontSize $smallestFontSize }}
  {{ $max := 2 }}
  {{ $min := 1 }}
  {{ if gt (len $hackerCountSorted) 0 }}
    {{ $max = add (index $hackerCountSorted 0).Value 1 }}
    {{ $min = (index $hackerCountSorted (sub (len $hackerCountSorted) 1)).Value }}
  {{ end }}
  {{ $spread := sub $max $min }}
  {{ $fontStep := cond (ne $spread 0) (div $fontSpread $spread) 0.1 }}

  {{ if gt (len $hackerCountSorted) 0 }}
  <h2>Hackers from {{ .Title | humanize | title }}</h2>

  <div id="tag-cloud">
      {{ range $hackerCountSorted }}
          {{ $currentFontSize := add $smallestFontSize (mul (sub .Value $min) $fontStep) }}
          <a href="/hacker/{{ .Key }}/" style="font-size:{{$currentFontSize}}{{$fontUnit}};">{{ .Name }}{{ if gt .Value 1 }}<sub>({{ .Value }})</sub>{{ end }}</a>
      {{ end }}
  </div>
  {{ end }}

  {{ partial "footer.html" . }} 
{{ end }}