{{ partial "header.html" . }}


{{- $hacker := .Data.Term -}}



<!-- Initialize data structures once -->
{{- $videoParams := slice -}}
{{- $categoryCounts := dict -}}
{{- $tools := slice -}}
{{- $collaborators := dict -}}
{{- $focusAreaData := dict -}}
{{- $hackerFirstTalk := now -}}
{{- $hackerLastTalk := time "1970-01-01" -}}

<!-- Load focus area data from content files -->
{{- $focusAreaPages := where $.Site.Pages "Section" "focus" -}}
{{- $focusAreaPages = where $focusAreaPages ".Params.focus_key" "!=" nil -}}
{{- $focusAreaConfig := dict -}}
{{- range $focusAreaPages -}}
  {{- $focusAreaConfig = merge $focusAreaConfig (dict .Params.focus_key (dict "name" .Title "color" .Params.color "icon" .Params.icon "tags" .Params.related_tags)) -}}
{{- end -}}

<!-- Single pass data extraction for better performance -->
{{- range .Pages -}}
  {{- $currentPage := . -}}
  {{- $talkDate := .Date -}}
  {{- if eq (printf "%T" $talkDate) "string" -}}
    {{- $talkDate = time $talkDate -}}
  {{- end -}}
  
  <!-- Track overall timeline dates -->
  {{- if $talkDate.Before $hackerFirstTalk -}}
    {{- $hackerFirstTalk = $talkDate -}}
  {{- end -}}
  {{- if $talkDate.After $hackerLastTalk -}}
    {{- $hackerLastTalk = $talkDate -}}
  {{- end -}}

  <!-- Video playlist generation -->
  {{- if and .Params.video (in .Params.video "youtube.com") -}}
    {{- range (split .Params.video " ") -}}
      {{- $videoID := index (split . "?v=") 1 | default "" -}}
      {{- if $videoID -}}
        {{- $videoParams = $videoParams | append $videoID -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  <!-- Session Type Count -->
  {{- $category := .Params.type -}}
  {{- if $category -}}
    {{- $categoryCounts = merge $categoryCounts (dict $category (add (index $categoryCounts $category | default 0) 1)) -}}
  {{- end -}}

  <!-- Tools Section -->
  {{- $tool := .Params.tool -}}
  {{- if $tool -}}
    {{- if eq (printf "%T" $tool) "string" -}}
      {{- $tools = $tools | append (upper $tool) -}}
    {{- else if eq (printf "%T" $tool) "[]string" -}}
      {{- $tools = $tools | append (apply $tool "upper" ".") -}}
    {{- end -}}
  {{- end -}}

  <!-- Collaborator Section -->
  {{- if .Params.hacker -}}
    {{- range .Params.hacker -}}
      {{- $collab := . | lower -}}
      {{- if and (ne $collab $hacker) (ne $collab "") -}}
        {{- $collaborators = merge $collaborators (dict $collab (add (index $collaborators $collab | default 0) 1)) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  <!-- Focus Area Timeline Data -->
  {{- if .Params.tag -}}
    {{- range .Params.tag -}}
      {{- $tag := . | lower -}}
      {{- /* Find which focus area this tag belongs to using content files */ -}}
      {{- $matchingFocusArea := "" -}}
      {{- if $focusAreaConfig -}}
        {{- range $areaKey, $areaData := $focusAreaConfig -}}
          {{- if in $areaData.tags $tag -}}
            {{- $matchingFocusArea = $areaKey -}}
            {{- break -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
      
      {{- if $matchingFocusArea -}}
        {{- $existingData := index $focusAreaData $matchingFocusArea -}}
        {{- if not $existingData -}}
          {{- $focusAreaData = merge $focusAreaData (dict $matchingFocusArea (dict "count" 1 "first_talk" $talkDate "last_talk" $talkDate "name" (index $focusAreaConfig $matchingFocusArea).name "color" (index $focusAreaConfig $matchingFocusArea).color)) -}}
        {{- else if eq (printf "%T" $existingData) "map[string]interface {}" -}}
          {{- $firstTalk := $existingData.first_talk -}}
          {{- $lastTalk := $existingData.last_talk -}}
          {{- if $talkDate.Before $firstTalk -}}
            {{- $firstTalk = $talkDate -}}
          {{- end -}}
          {{- if $talkDate.After $lastTalk -}}
            {{- $lastTalk = $talkDate -}}
          {{- end -}}
          {{- $focusAreaData = merge $focusAreaData (dict $matchingFocusArea (dict "count" (add $existingData.count 1) "first_talk" $firstTalk "last_talk" $lastTalk "name" $existingData.name "color" $existingData.color)) -}}
        {{- else -}}
          {{- /* Reset if existing data is not a dictionary */ -}}
          {{- $focusAreaData = merge $focusAreaData (dict $matchingFocusArea (dict "count" 1 "first_talk" $talkDate "last_talk" $talkDate "name" (index $focusAreaConfig $matchingFocusArea).name "color" (index $focusAreaConfig $matchingFocusArea).color)) -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

<!-- Profile Header Section -->
<div class="profile-header">
  {{- $imgBasePath := path.Join "static" "hacker" $hacker -}}
  {{- $extensions := slice ".jpg" ".png" ".jpeg" ".jfif" -}}
  {{- $photopath := "" -}}
  
  {{- range $ext := $extensions -}}
    {{- if (fileExists (print $imgBasePath $ext)) -}}
      {{- $photopath = print "/hacker/" $hacker $ext -}}
      {{- break -}}
    {{- end -}}
  {{- end -}}

  {{- if $photopath }}
    <img class="profile-image" src="{{ $photopath }}" alt="Profile photo of {{ .Title | title }}">
  {{ end }}

  <div class="profile-info">
    <h1>{{ .Title | markdownify | title }}</h1>
    <div class="profile-links">
      {{ partial "social.html" . }}
    </div>
    {{ if gt (len $videoParams) 0 }}
      <div class="mt-3">
        <a href="https://www.youtube.com/watch_videos?video_ids={{ delimit $videoParams "," }}" target="_blank" rel="noreferrer noopener">ðŸ“¹ Dynamic Video Playlist</a>
      </div>
    {{ end }}
  </div>
</div>

<!-- Prepare unique tools list -->
{{- $uniqueTools := slice -}}
{{- range $tools -}}
  {{- if not (in $uniqueTools .) -}}
    {{- $uniqueTools = $uniqueTools | append (upper .) -}}
  {{- end -}}
{{- end -}}

<!-- Prepare collaborators list -->
{{- $commonCollaborators := slice -}}
{{- range $name, $count := $collaborators -}}
  {{- if gt $count 1 -}}
    {{- $commonCollaborators = $commonCollaborators | append (dict "name" $name "count" $count) -}}
  {{- end -}}
{{- end -}}

<!-- Activities Summary -->
{{- if or (len $categoryCounts) (len $uniqueTools) (gt (len $commonCollaborators) 0) -}}
  <div class="info-box">
    {{- if len $categoryCounts -}}
      <p><strong>Activities:</strong> 
        {{- range $category, $count := $categoryCounts -}}
          {{ $category | humanize | title }} - {{ $count }};
        {{- end -}}
      </p>
    {{ end }}
    
    {{ if len $uniqueTools }}
      <p><strong>Tools Contributed or Authored:</strong>
        {{- range $uniqueTools -}}
          <a href="/tool/{{ . | urlize }}">{{ . }}</a>&nbsp;
        {{- end -}}
      </p>
    {{ end }}
    
    {{ if gt (len $commonCollaborators) 0 }}
      <p><strong>Common Collaborators:</strong>
        {{- range (sort $commonCollaborators "count" "desc") -}}
          <a href="/hacker/{{ .name }}">{{ .name | humanize | title }}({{ .count }})</a>&nbsp;
        {{- end -}}
      </p>
    {{ end }}
  </div>
{{ end }}

<!-- Timeline Section -->
{{- $timelineYears := add (sub $hackerLastTalk.Year $hackerFirstTalk.Year) 1 -}}
{{- $focusAreas := slice -}}
{{- range $tag, $data := $focusAreaData -}}
  {{- if eq (printf "%T" $data) "map[string]interface {}" -}}
    {{- $focusAreas = $focusAreas | append (dict "tag" $tag "data" $data) -}}
  {{- end -}}
{{- end -}}
{{- $topFocusAreas := first 10 (sort $focusAreas "data.count" "desc") -}}

{{ if $.Site.Params.experimental_mode }}

  {{ if and (gt (len $topFocusAreas) 0) (gt $timelineYears 3) }}
    <hr />
    <details class="experimental-timeline">
      <summary>
        Experimental Timeline
      </summary>

      <!-- Common Topics -->
      {{- $commonTags := slice -}}
      {{- range $tag, $data := $focusAreaData -}}
        {{- if and (eq (printf "%T" $data) "map[string]interface {}") (gt $data.count 2) -}}
          {{- $commonTags = $commonTags | append (dict "tag" $tag "count" $data.count) -}}
        {{- end -}}
      {{- end -}}

      {{ if gt (len $commonTags) 0 }}
        <section aria-labelledby="topics-heading">
          <b id="topics-heading">Common Topics (3+ talks): </b>
            {{- range (sort $commonTags "count" "desc") -}}
              <a href="/tag/{{ .tag | urlize }}/"><strong>{{ .tag | humanize | title }}({{ .count }})</strong></a>;
            {{- end -}}
        </section>
      {{ end }}

      <!-- Timeline Visualization -->
      {{ if gt (len $topFocusAreas) 0 }}
        <div class="timeline-container">
          <div>
            <!-- Year markers and 25% intervals -->
            <div class="timeline-year-markers">
              {{- $startYear := $hackerFirstTalk.Year -}}
              {{- $endYear := $hackerLastTalk.Year -}}
              {{- range $year := seq $startYear $endYear -}}
                {{- $yearPct := mul (div (sub $year $startYear | float) $timelineYears) 100.0 -}}
                <div class="timeline-year-label" style="left: {{ printf "%.2f" $yearPct }}%;">
                  {{ $year }}
                </div>
                <div class="timeline-year-tick" style="left: {{ printf "%.2f" $yearPct }}%;"></div>
              {{- end -}}
              <!-- 25% interval markers -->
              {{- range $i := seq 1 3 -}}
                {{- $pct := mul $i 25.0 -}}
                <div class="timeline-interval-tick" style="left: {{ printf "%.2f" $pct }}%;"></div>
              {{- end -}}
            </div>
            
            <!-- Focus area bars with titles on bars -->
            {{- range $i, $fa := $topFocusAreas -}}
              {{- $tag := $fa.tag -}}
              {{- $data := $fa.data -}}
              {{- $faFirst := $data.first_talk -}}
              {{- $faLast := $data.last_talk -}}
              {{- if eq (printf "%T" $faFirst) "string" }}{{ $faFirst = time $faFirst }}{{ end -}}
              {{- if eq (printf "%T" $faLast) "string" }}{{ $faLast = time $faLast }}{{ end -}}
              {{- $startPct := mul (div (sub $faFirst.Year $hackerFirstTalk.Year | float) $timelineYears) 100.0 -}}
              {{- $endPct := mul (div (add (sub $faLast.Year $hackerFirstTalk.Year) 1 | float) $timelineYears) 100.0 -}}
              {{- $widthPct := sub $endPct $startPct -}}
              <div class="timeline-focus-area">
                <div class="timeline-focus-background"></div>
                <div class="timeline-focus-bar" style="left: {{ printf "%.2f" $startPct }}%; width: {{ printf "%.2f" $widthPct }}%; background: {{ $data.color }};">
                  <div class="timeline-focus-label">
                    <a href="/focus/{{ $fa.tag | urlize }}/">{{ $data.name }}</a>
                  </div>
                </div>
              </div>
            {{- end -}}
          </div>
        </div>
      {{ end }}
    </details>
  {{ end }}
{{ end }}
<!-- Hacktivity Timeline -->
<section>
  <h2>Hacktivity</h2>
  
  <div class="timeline">
    {{ range .Pages.GroupByDate "2006" }}
      <div class="timeline-year">---- {{ .Key }} ----</div>
      {{ range .Pages }}
        <div class="timeline-item">
          <div class="timeline-date">{{ .Date.Format "2006/01/02" }}</div>
          <div class="timeline-content">
            <span class="badge{{ if or (eq .Params.type "Keynote") (eq .Params.type "Book") }} badge-secondary{{ end }}">{{ .Params.type | humanize | title }}</span>
            <a href="/{{ cond .Params.award (printf "award/%s" .Params.award) (cond .Params.publisher (printf "publisher/%s" .Params.publisher) (printf "conference/%s" .Params.conference)) | lower | urlize }}">{{ cond .Params.award .Params.award (cond .Params.publisher .Params.publisher .Params.conference) | humanize | title }}</a>{{ partial "subconference.html" . }}:
            <a href="{{ .RelPermalink }}">{{ .Title | markdownify }}</a>
            {{- $totalHackers := 0 -}}
            {{- if .Params.hacker -}}
              {{- $totalHackers = add $totalHackers (len .Params.hacker) -}}
            {{- end -}}
            {{- if .Params.morehackers -}}
              {{- $totalHackers = add $totalHackers (len .Params.morehackers) -}}
            {{- end -}}
            
            {{- if gt $totalHackers 1 -}}
             - 
              {{- if .Params.hacker -}}
                {{- range .Params.hacker -}}
                    <a href="/hacker/{{ . }}/">{{ . | humanize | title }}</a>,
                {{- end -}}
              {{- end -}}
              {{- if .Params.morehackers -}}
                {{- range .Params.morehackers -}}
                  <u>{{ . | humanize | title }}</u>,
                {{- end -}}
              {{- end -}}
            {{- end -}}
            {{- $paramValue := .Params -}}
            {{- range (slice "presentation" "whitepaper" "Source" "video") -}}
              {{- $type := . -}}
              {{- $val := index $paramValue $type -}}
              {{- with $val -}}
                <a href="{{ . }}" class="resource-icon" target="_blank" rel="noreferrer noopener nofollow" title="{{ $type | title }}">
                  {{ if eq $type "presentation" }}ðŸ“Š{{ else if eq $type "whitepaper" }}ðŸ“„{{ else if eq $type "Source" }}ðŸ’¾{{ else if eq $type "video" }}ðŸ“¹{{ end }}
                </a>
              {{- end -}}
            {{- end -}}
          </div>
        </div>
      {{ end }}
    {{ end }}
  </div>
</section>

{{ partial "footer.html" . }}
