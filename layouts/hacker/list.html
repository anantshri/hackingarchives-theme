{{ partial "header.html" . }}
<center>
  <div class="card">
    {{ $hacker := .Data.Term | lower }}
    {{- $imgBasePath := path.Join "static" "hacker" $hacker  -}}
    {{- $extensions := slice ".jpg" ".png" ".jpeg" ".jfif" -}}
    {{- $photopath := "" -}}
    
    {{ range $ext := $extensions }}
      {{ if (fileExists (print $imgBasePath $ext)) }}
        {{ $photopath = print "/hacker/" $hacker $ext }}
        {{ break }}
      {{ end }}
    {{ end }}

    {{- if $photopath }}
      <img class="profilephoto" src="{{ $photopath }}" alt="Avatar">
    {{ end }}
    <div class="container">
      <h2><b>{{ .Title | markdownify | title }}</b></h2>
      <p>  
{{ partial "social.html" . }}
        {{ $pages := .Pages }}
        {{ if .IsHome }}{{ $pages = .Site.RegularPages }}{{ end }}

        <!-- Video playlist generation -->
        {{ $videoParams := slice }}
        {{ range (where $pages "Section" "!=" "") }}
          {{ if and .Params.video (in .Params.video "youtube.com") }}
            {{ $videoURLs := split .Params.video " " }}
            {{ range $videoURLs }}
              {{ $queryString := index (split . "?") 1 }}
              {{ $params := split $queryString "&" }}
              {{ range $params }}
                {{ $param := split . "=" }}
                {{ if eq (index $param 0) "v" }}
                  {{ $videoParams = $videoParams | append (index $param 1) }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        {{ if gt (len $videoParams) 0 }}
          <br />
          <a href="https://www.youtube.com/watch_videos?video_ids={{ delimit $videoParams "," }}" target="_blank" rel="noreferrer noopener">Dynamic Video Playlist</a>
        {{ end }}
      </p>
    </div>
  </div>
</center>

<!-- Category and session type section -->
{{ $disclosures := where $pages "Section" "!=" "" }}
{{ $categoryCounts := dict }}
{{ range $disclosures }}
  {{ $category := .Params.type }}
  {{ if $category }}
    {{ $count := add (index $categoryCounts $category | default 0) 1 }}
    {{ $categoryCounts = merge $categoryCounts (dict $category $count) }}
  {{ end }}
{{ end }}
<hr />
<p>
  <b>Type of Sessions Delivered:</b>
  {{ range $category, $count := $categoryCounts }}
    <i>{{ $category | humanize | title }} - {{ $count }}</i>;
  {{ end }}
</p>

<!-- Tools section -->
{{ $tools := slice }}
{{ range .Pages }}
  {{ $tool := .Params.tool }}
  {{ if $tool }}
    {{ if eq (printf "%T" $tool) "string" }}
      {{ $tools = $tools | append (upper $tool) }}
    {{ else }}
      {{ range $tool }}
        {{ $tools = $tools | append (upper .) }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

<!-- Remove duplicate tools -->
{{ $uniqueTools := slice }}
{{ range $tools }}
  {{ if not (in $uniqueTools .) }}
    {{ $uniqueTools = $uniqueTools | append . }}
  {{ end }}
{{ end }}

{{ if len $uniqueTools }}
  <hr />
  <b>Tools Contributed or Authored:</b>
  {{ range $uniqueTools }}
    <b><a href="/tool/{{ . | urlize }}">{{ . }}</a></b>&nbsp;&nbsp;
  {{ end }}
{{ end }}

{{ $collaborators := dict }}

{{ $collaborators := dict }}

<!-- Loop through all pages to gather collaborators -->
{{ range .Pages }}
  {{ range .Params.hacker }}
    {{ $collaborator := . | lower  }}
    {{ if ne $collaborator $hacker }}
      {{ $count := add (index $collaborators $collaborator | default 0) 1 }}
      {{ $collaborators = merge $collaborators (dict $collaborator $count) }}
    {{ end }}
  {{ end }}
  {{ range .Params.morehackers }}
    {{ $collaborator := . | lower }}
    {{ if ne $collaborator $hacker }}
      {{ $count := add (index $collaborators $collaborator | default 0) 1 }}
      {{ $collaborators = merge $collaborators (dict $collaborator $count) }}
    {{ end }}
  {{ end }}
{{ end }}

<!-- Filter and display common collaborators with more than 2 contributions -->
{{ $commonCollaborators := slice }}
{{ range $name, $count := $collaborators }}
  {{ if gt $count 2 }}
    {{ $commonCollaborators = $commonCollaborators | append (dict "name" $name "count" $count) }}
  {{ end }}
{{ end }}

{{ if gt (len $commonCollaborators) 0 }}
  <hr />
<b>Common Collaborators:</b>
    {{ range $name, $count := $commonCollaborators }}
        <a href="/hacker/{{ .name }}">{{ .name | humanize | title }}({{ .count }})</a>; 
    {{ end }}
{{ end }}

<hr />


<h1>Hacktivity</h1>
<hr />
{{ range .Pages.GroupByDate "2006" }}
  <center class="year-key"><b>---- {{ .Key }} ----</b></center>
  <ul>
    {{ range .Pages }}
      <li>
        <span class="date">{{ .Date.Format "2006/01/02" }}</span>
        <a href="/type/{{ .Params.type | urlize }}/">{{ .Params.type | humanize | title }}</a> :
        {{ if .Params.award }}
          <a href="/award/{{ .Params.award | lower | urlize }}">{{ .Params.award | humanize | title }}</a>
        {{ else }}
          <a href="/conference/{{ .Params.conference | lower | urlize }}">{{ .Params.conference | humanize | title }}</a>
        {{ end }}
        <!-- Sub-conference details can be added inline here if needed -->
        : <a href="{{ .RelPermalink }}">{{ .Title | markdownify }}</a> -
        {{ range .Params.hacker }}
          <a href="/hacker/{{ . }}/">{{ . | humanize | title }}</a>
        {{ end }}
        {{ range .Params.morehackers }}
          <u>{{ . | humanize | title }}</u>
        {{ end }}
        {{ if .Params.presentation }}
          <a href="{{ .Params.presentation }}" target="_blank" rel="noreferrer noopener nofollow">
            <img src="/fontawesome/presentation.svg" style="width:15px; padding-left:2px;">
          </a>
        {{ end }}
        {{ if .Params.whitepaper }}
          <a href="{{ .Params.whitepaper }}" target="_blank" rel="noreferrer noopener nofollow">
            <img src="/fontawesome/whitepaper.svg" style="width:15px; padding-left:2px;">
          </a>
        {{ end }}
        {{ if .Params.Source }}
          <a href="{{ .Params.Source }}" target="_blank" rel="noreferrer noopener nofollow">
            <img src="/fontawesome/code.svg" style="width:15px; padding-left:2px;">
          </a>
        {{ end }}
        {{ if .Params.video }}
          <a href="{{ .Params.video }}" target="_blank" rel="noreferrer noopener nofollow">
            <img src="/fontawesome/video.svg" style="width:15px; padding-left:2px;">
          </a>
        {{ end }}
      </li>
    {{ end }}
  </ul>
{{ end }}
{{ partial "footer.html" . }}